<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moscow Spotlight</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: var(--tg-theme-bg-color, #1c1c1e);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            text-align: center;
        }

        .container {
            width: 90%;
            max-width: 400px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —Ç–∞–±–ª–æ */
        .spotlight-box {
            background: linear-gradient(145deg, #2c2c2e, #3a3a3c);
            border-radius: 20px;
            padding: 30px 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }

        #main-text {
            font-size: 22px;
            line-height: 1.4;
            font-weight: 600;
            transition: opacity 0.5s ease-in-out; /* –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
        }

        .verified-badge {
            color: #FFD700; /* –ó–æ–ª–æ—Ç–æ */
            font-size: 14px;
            margin-top: 10px;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .action-btn {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(51, 144, 236, 0.4);
            transition: transform 0.1s;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        .price-label {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.7;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            color: #888;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>MOSCOW SPOTLIGHT üá∑üá∫</h1>

        <div class="spotlight-box">
            <div id="main-text">üì° –ü–æ–∏—Å–∫ —Å–∏–≥–Ω–∞–ª–∞...</div>
            <div id="verified-badge" class="verified-badge">
                Verified Resident ‚≠êÔ∏è
            </div>
        </div>

        <button class="action-btn" onclick="buy()">
            –ó–ê–•–í–ê–¢–ò–¢–¨ –≠–§–ò–† –∑–∞ <span id="btn-price">...</span> ‚≠êÔ∏è
        </button>
        <div class="price-label">
            –¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞: <span id="current_price">...</span> ‚≠êÔ∏è
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // === –ù–ê–°–¢–†–û–ô–ö–ò ===
        // –í–∞—à–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç—É–Ω–Ω–µ–ª—å (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –ª–∏ –æ–Ω–∞ –≤ systemctl)
        const DATA_URL = "https://issues-glucose-header-synopsis.trycloudflare.com/data";
        
        // –ù–∞—à–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–∏
        const promoMessages = [
            "üì¢ –≠–§–ò–† –°–í–û–ë–û–î–ï–ù!\n–¢–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–≤–∏–¥—è—Ç –≤—Å–µ.",
            "üí∞ –ü–†–ò–í–ï–î–ò –î–†–£–ì–ê\n–ü–æ–ª—É—á–∏ % –æ—Ç –µ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞!",
            "üëë VERIFIED RESIDENT\n–ü–æ–ª—É—á–∏ –∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞—Ç—É—Å –º–∞—Å—Ç–µ—Ä–∞.",
            "üöÄ MOSCOW SPOTLIGHT\n–ó–∞—Ö–≤–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å–µ–π—á–∞—Å!"
        ];

        let promoIndex = 0;
        let isPromoActive = false;
        let promoInterval = null;

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É)
        function buy() {
            tg.sendData("action_buy_spotlight"); 
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ñ—Ä–∞–∑
        function rotatePromo() {
            const textElement = document.getElementById('main-text');
            
            // 1. –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
            textElement.style.opacity = 0;

            setTimeout(() => {
                // 2. –°–º–µ–Ω–∞ —Ç–µ–∫—Å—Ç–∞ (–ø–æ–∫–∞ –Ω–µ–≤–∏–¥–∏–º—ã–π)
                textElement.innerText = promoMessages[promoIndex];
                
                // 3. –ü–æ—è–≤–ª–µ–Ω–∏–µ
                textElement.style.opacity = 1;

                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ—Ä–∞–∑–µ
                promoIndex = (promoIndex + 1) % promoMessages.length;
            }, 500); // –ñ–¥–µ–º 0.5 —Å–µ–∫ –ø–æ–∫–∞ –∏—Å—á–µ–∑–Ω–µ—Ç
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function update() {
            try {
                const res = await fetch(DATA_URL);
                const data = await res.json();

                const textElement = document.getElementById('main-text');
                const badgeElement = document.getElementById('verified-badge');
                const btnPrice = document.getElementById('btn-price');
                const currentPrice = document.getElementById('current_price');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã –≤—Å–µ–≥–¥–∞
                btnPrice.innerText = data.price;
                currentPrice.innerText = data.price;

                // === –õ–û–ì–ò–ö–ê –≠–§–ò–†–ê ===
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Å–ª–æ–≤–æ "–°–≤–æ–±–æ–¥–Ω–æ" (–∏–ª–∏ ID=0, –µ—Å–ª–∏ –±—ã –æ–Ω –±—ã–ª), –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–∫–ª–∞–º—É
                if (data.owner && data.owner.includes("–°–≤–æ–±–æ–¥–Ω–æ")) {
                    
                    // –ï—Å–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ - –∑–∞–ø—É—Å–∫–∞–µ–º
                    if (!isPromoActive) {
                        isPromoActive = true;
                        badgeElement.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∑–Ω–∞—á–æ–∫
                        rotatePromo(); // –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—É—é —Å—Ä–∞–∑—É
                        promoInterval = setInterval(rotatePromo, 5000); // –ú–µ–Ω—è—Ç—å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
                    }
                    
                } else {
                    // === –≠–§–ò–† –ó–ê–ù–Ø–¢ (–ö–¢–û-–¢–û –ö–£–ü–ò–õ) ===
                    if (isPromoActive) {
                        clearInterval(promoInterval); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∫–ª–∞–º—É
                        isPromoActive = false;
                    }
                    
                    textElement.style.opacity = 1;
                    textElement.innerText = data.owner; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Verified Resident
                    if (data.is_verified) {
                        badgeElement.style.display = 'flex'; // –ü–æ–∫–∞–∑–∞—Ç—å –∑–æ–ª–æ—Ç–æ
                    } else {
                        badgeElement.style.display = 'none';
                    }
                }

            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏:", e);
                // –ú–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏" –Ω–∞ —ç–∫—Ä–∞–Ω–µ, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(update, 2000);
        update(); // –ò –æ–¥–∏–Ω —Ä–∞–∑ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    </script>
</body>
</html>
