import asyncio
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command
from aiogram.types import WebAppInfo, LabeledPrice, PreCheckoutQuery

# –¢–í–û–ô –¢–û–ö–ï–ù
API_TOKEN = '8360675235:AAE32kVtDO7Dd2TlbB2mjzaO4lh7EZW...' # –û—Å—Ç–∞–≤—å —Å–≤–æ–π –ø–æ–ª–Ω—ã–π —Ç–æ–∫–µ–Ω

bot = Bot(token=API_TOKEN)
dp = Dispatcher()

@dp.message(lambda message: message.web_app_data)
async def handle_web_app_data(message: types.Message):
    if message.web_app_data.data == "action_buy_stars":
        await bot.send_invoice(
            chat_id=message.chat.id,
            title="–ó–∞—Ö–≤–∞—Ç –ú–æ—Å–∫–≤—ã",
            description="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–≤–∏–¥–∏—Ç –≤—Å—è –ú–æ—Å–∫–≤–∞!",
            payload="capture_payload",
            currency="XTR",
            prices=[LabeledPrice(label="–ó–∞—Ö–≤–∞—Ç", amount=10)],
            provider_token=""
        )

@dp.pre_checkout_query()
async def process_pre_checkout_query(pre_checkout_query: PreCheckoutQuery):
    await bot.answer_pre_checkout_query(pre_checkout_query.id, ok=True)

@dp.message(F.successful_payment)
async def process_successful_payment(message: types.Message):
    await message.answer("üéâ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞! –í—ã –∑–∞—Ö–≤–∞—Ç–∏–ª–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –ú–æ—Å–∫–≤—ã!")

@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    markup = types.ReplyKeyboardMarkup(
        keyboard=[
            [types.KeyboardButton(
                text="üöÄ –û–¢–ö–†–´–¢–¨ MOSCOW SPOTLIGHT", 
                web_app=WebAppInfo(url="https://the934og-netizen.github.io/moscow-spotlight/")
            )]
        ],
        resize_keyboard=True
    )
    await message.answer(f"–ü—Ä–∏–≤–µ—Ç, {message.from_user.full_name}! –ì–æ—Ç–æ–≤ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —ç—Ñ–∏—Ä?", reply_markup=markup)

async def main():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ó–≤–µ–∑–¥—ã...")
    await dp.start_polling(bot)

if __name__ == '__main__':
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("–ë–æ—Ç –≤—ã–∫–ª—é—á–µ–Ω")
